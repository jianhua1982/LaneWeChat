<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Pay Demo</title><style>div{margin:10px;padding:10px;-webkit-box-sizing:border-box}select#channel{font-size:2em;width:150px;height:40px;float:left}button#submit,input#money{float:left;font-size:larger;margin-left:0;margin-top:20px;padding:20px}input#money{border:dotted}button#submit{border:solid;border:none;width:150px}</style></head><body><div><p>请选择付款类型</p><select id="channel"><option value="01">支付宝</option><option value="02">微信支付</option><option value="03">银联钱包</option><option value="04">百度钱包</option></select><input id="money" type="text" placeholder="付款金额"><button id="submit">提交</button></div><script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script><script src="../js/zepto.min.js"></script><script>function ajaxPhp(e,n,o,a){"use strict";$.ajax({type:"GET",url:PHP_ROOT+"?appName="+appName+"&requestAction="+e,dataType:"json",data:n,success:function(e){o&&("string"==typeof e&&(e=JSON.parse(e)),o(e))},error:function(e){if(a)a(e);else{var n="err = "+JSON.stringify(e);console.log(n)}}})}function ajax2Backend(e,n,o,a){"use strict";"object"==typeof n&&(n=JSON.stringify(n)),$.ajax({type:"POST",url:BACKEND_ROOT+e,contentType:"application/json",dataType:"json",data:n,success:function(e){o&&o(e)},error:function(e){if(a)a(e);else{var n="err = "+JSON.stringify(e);console.log(n),alert(n)}}})}function notifyConsumer(e){}var BACKEND_ROOT="http://www.wygreen.cn/",PHP_ROOT=BACKEND_ROOT+"LaneWeChat/wechat.php",appName="testaccount",devUserOpenId="",receiptUserOpenId="",isWX=navigator.userAgent.toLowerCase().indexOf("micromessenger")>=0,amount="0.01",urlParams=function(e){e||(e=location.search),("?"===e[0]||"#"===e[0])&&(e=e.substring(1));var n={};return e.replace(/\b([^&=]*)=([^&=]*)/g,function(e,o,a){"undefined"!=typeof n[o]?n[o]+=","+decodeURIComponent(a):n[o]=decodeURIComponent(a)}),n}();if(isWX)if(urlParams&&urlParams.rr&&urlParams.rr.length);else{var href=window.location.href;href+=href.indexOf("?")<0?"?":"&",window.location.replace(href+"rr="+Math.round(1e4*Math.random()))}else ajaxPhp("scanCodePay",{id:"0101",amount:"0.01",openId:"oDpaVjui28PrVkUHjaCdbjxJvUb0",authCode:"qr11233333"},function(e){});document.addEventListener("DOMContentLoaded",function(){function e(e){ajaxPhp("wxJsSignature",null,function(e){var n="data = "+JSON.stringify(e);console.log(n);var o=e;$.extend(o,{debug:!1,jsApiList:["scanQRCode"]}),wx.config(o),wx.ready(function(){console.log(">> ready")}),wx.error(function(e){alert(e&&e.errMsg)})})}if(console.log("Got DOMContentLoaded"),$("#money").val(amount),$("#submit").on("click",function(){console.log("click"),wx.ready(function(){console.log(">> ready"),wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){var n=e.resultStr;if(n&&n.length){var a={id:$("#channel").val()+"01",amount:$("#money").val(),openId:o,authCode:n};alert(JSON.stringify(a)),ajaxPhp("scanCodePay",a,function(e){alert(JSON.stringify(e))},function(e){alert(JSON.stringify(e))})}}})})}),isWX)if(urlParams.code&&urlParams.code.length)ajaxPhp("fetchOpenid",null,function(a){o=a.openid,localStorage.setItem(n,o),e(o)});else{var n="www.qianduoduo.com.openid",o=localStorage.getItem(n);o&&o.length?e(o):window.location.href=PHP_ROOT+"?appName="+appName+"&requestAction=fetchCode"}else e("12344567890")},!1);</script></body></html>