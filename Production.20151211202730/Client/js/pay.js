function ajaxPhp(e,n,a,o){"use strict";$.ajax({type:"GET",url:PHP_ROOT+"?appName="+appName+"&requestAction="+e,dataType:"json",data:n,success:function(e){a&&("string"==typeof e&&(e=JSON.parse(e)),a(e))},error:function(e){if(o)o(e);else{var n="err = "+JSON.stringify(e);console.log(n)}}})}function ajax2Backend(e,n,a,o){"use strict";$.ajax({type:"GET",url:BACKEND_ROOT+e,dataType:"json",data:n,success:function(e){a&&a(e)},error:function(e){if(o)o(e);else{var n="err = "+JSON.stringify(e);console.log(n),alert(n)}}})}var BACKEND_ROOT="http://www.wygreen.cn/LaneWeChat/",PHP_ROOT=BACKEND_ROOT+"wechat.php",appName="testaccount",urlParams=function(e){e||(e=location.search),("?"===e[0]||"#"===e[0])&&(e=e.substring(1));var n={};return e.replace(/\b([^&=]*)=([^&=]*)/g,function(e,a,o){"undefined"!=typeof n[a]?n[a]+=","+decodeURIComponent(o):n[a]=decodeURIComponent(o)}),n}();if(urlParams&&urlParams.rr&&urlParams.rr.length);else{var href=window.location.href;href+=href.indexOf("?")<0?"?":"&",window.location.href=href+"rr="+1e4*Math.random()}document.addEventListener("DOMContentLoaded",function(){function e(){ajaxPhp("wxJsSignature",null,function(e){var n="data = "+JSON.stringify(e);console.log(n);var a=e;$.extend(a,{debug:!1,jsApiList:["scanQRCode"]}),wx.config(a),wx.ready(function(){console.log(">> ready")}),wx.error(function(e){alert(e&&e.errMsg)})})}if(console.log("Got DOMContentLoaded"),$("#submit").on("click",function(){wx.ready(function(){console.log(">> ready"),wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){var n=e.resultStr;if(n&&n.length){var o={channel:$("#channel").val(),money:$("#money").val(),openid:a,scanCode:n};return void alert(JSON.stringify(o))}}})})}),urlParams.code&&urlParams.code.length)ajaxPhp("fetchOpenid",null,function(o){a=o.openid,localStorage.setItem(n,a),e(a)});else{var n="www.qianduoduo.com.openid",a=localStorage.getItem(n);a&&a.length?e(a):window.location.href=PHP_ROOT+"?appName="+appName+"&requestAction=fetchCode"}},!1);