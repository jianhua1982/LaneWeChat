<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><link rel="stylesheet" type="text/css" href="../../bootstrap-3.3.5/dist/css/bootstrap.min.css"><title>Pay Demo</title><style>div{margin:10px;padding:10px;-webkit-box-sizing:border-box}select#channel{font-size:2em;width:150px;height:40px;float:left}button#submit,input#money{float:left;font-size:larger;margin-left:0;margin-top:20px;padding:20px}input#money{border:dotted}button#submit{border:solid;border:none;width:150px}</style></head><body><button type="button" id="myButton" data-loading-text="Loading..." class="btn btn-primary" autocomplete="off">Loading state</button><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><div><p>请选择付款类型</p><select id="channel"><option value="02">支付宝</option><option value="03">微信支付</option><option value="01">银联钱包</option><option value="04">百度钱包</option></select><input id="money" type="text" placeholder="付款金额"><button id="submit">提交</button></div><script src="//res.wx.qq.com/open/js/jweixin-1.0.0.js"></script><script src="../js/jquery.min.js"></script><script src="../../bootstrap-3.3.5/dist/js/bootstrap.min.js"></script><script>function ajaxPhp(e,n,o,t){"use strict";$.ajax({type:"GET",url:PHP_ROOT+"?appName="+appName+"&requestAction="+e,dataType:"json",data:n,success:function(e){o&&("string"==typeof e&&(e=JSON.parse(e)),o(e))},error:function(e){if(t)t(e);else{var n="err = "+JSON.stringify(e);console.log(n)}}})}function ajax2Backend(e,n,o,t){"use strict";"object"==typeof n&&(n=JSON.stringify(n)),$.ajax({type:"POST",url:BACKEND_ROOT+e,dataType:"json",data:n,success:function(e){o&&o(e)},error:function(e){if(t)t(e);else{var n="err = "+JSON.stringify(e);console.log(n),alert(n)}}})}document.addEventListener("DOMContentLoaded",function(){$(function(){$('[data-toggle="popover"]').popover()}),$("#myButton").on("click",function(){console.log("click...");var e=$(this).button("loading");e.button("reset")})});var BACKEND_ROOT="http://www.wygreen.cn/",PHP_ROOT=BACKEND_ROOT+"LaneWeChat/wechat.php",appName="testaccount",isWX=navigator.userAgent.toLowerCase().indexOf("micromessenger")>=0,amount="0.01",urlParams=function(e){e||(e=location.search),("?"===e[0]||"#"===e[0])&&(e=e.substring(1));var n={};return e.replace(/\b([^&=]*)=([^&=]*)/g,function(e,o,t){"undefined"!=typeof n[o]?n[o]+=","+decodeURIComponent(t):n[o]=decodeURIComponent(t)}),n}();if(isWX)if(urlParams&&urlParams.rr&&urlParams.rr.length);else{var href=window.location.href;href+=href.indexOf("?")<0?"?":"&",window.location.replace(href+"rr="+Math.round(1e4*Math.random()))}document.addEventListener("DOMContentLoaded",function(){function e(e){ajaxPhp("wxJsSignature",null,function(e){var n="data = "+JSON.stringify(e);console.log(n);var o=e;$.extend(o,{debug:!1,jsApiList:["scanQRCode"]}),wx.config(o),wx.ready(function(){console.log(">> ready")}),wx.error(function(e){alert(e&&e.errMsg)})})}if(console.log("Got DOMContentLoaded"),$("#money").val(amount),$("#submit").on("tap",function(){console.log("tap"),wx.ready(function(){console.log(">> ready"),wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){var n=e.resultStr;if(n&&n.length){var t={id:$("#channel").val()+"01",amount:$("#money").val(),openID:o,auth_code:n};alert(JSON.stringify(t)),ajax2Backend("zero/scanweb",t,function(e){alert(JSON.stringify(e))},function(e){alert(JSON.stringify(e))})}}})})}),isWX)if(urlParams.code&&urlParams.code.length)ajaxPhp("fetchOpenid",null,function(t){o=t.openid,localStorage.setItem(n,o),e(o)});else{var n="www.qianduoduo.com.openid",o=localStorage.getItem(n);o&&o.length?e(o):window.location.href=PHP_ROOT+"?appName="+appName+"&requestAction=fetchCode"}},!1);</script></body></html>