<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Pay Demo</title><style>div{margin:10px;padding:10px;-webkit-box-sizing:border-box}select#channel{font-size:2em;width:150px;height:40px;float:left}button#submit,input#money{float:left;font-size:larger;margin-left:0;margin-top:20px;padding:20px}input#money{border:dotted}button#submit{border:solid;border:none;width:150px}</style></head><body><div><p>请选择付款类型</p><select id="channel"><option value="01">支付宝</option><option value="02">微信支付</option><option value="03">银联钱包</option><option value="04">百度钱包</option></select><input id="money" type="text" placeholder="付款金额"><button id="submit">提交</button> <button id="refresh">刷新</button></div><script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script><script src="../js/zepto.min.js"></script><script>function replaceUrlByTimeline(){var e=window.location.href.split("?")[0];window.location.replace(e+"?rr="+Math.round(1e4*Math.random()))}function ajax2BackendByPhp(e,n,a,o){"use strict";function t(e){"string"==typeof e&&(e=JSON.parse(e)),o?o(e):console.log(e&&e.msg?e.msg:"网络不给力，请您稍后再试！")}$.ajax({type:"GET",url:PHP_ROOT+"?appName="+appName+"&requestAction="+e,dataType:"json",data:n,success:function(e){a&&("string"==typeof e&&(e=JSON.parse(e)),"00"===e.code?a&&a(e):t(e))},error:function(e){t(e)}})}function ajax2Php(e,n,a,o){"use strict";$.ajax({type:"GET",url:PHP_ROOT+"?appName="+appName+"&requestAction="+e,dataType:"json",data:n,success:function(e){a&&a(e)},error:function(n){o?o(n):alert("ajax2Php for "+e+" failed!!")}})}function ajax2Backend(e,n,a,o){"use strict";"object"==typeof n&&(n=JSON.stringify(n)),$.ajax({type:"POST",url:BACKEND_ROOT+e,contentType:"application/json",dataType:"json",data:n,success:function(e){a&&a(e)},error:function(e){if(o)o(e);else{var n="err = "+JSON.stringify(e);console.log(n),alert(n)}}})}function notifyConsumer(e){}var BACKEND_ROOT="http://www.wygreen.cn/",PHP_ROOT=BACKEND_ROOT+"LaneWeChat/wechat.php",appName="testaccount",devUserOpenId="",receiptUserOpenId="",isWX=navigator.userAgent.toLowerCase().indexOf("micromessenger")>=0,amount="0.01",urlParams=function(e){e||(e=location.search),("?"===e[0]||"#"===e[0])&&(e=e.substring(1));var n={};return e.replace(/\b([^&=]*)=([^&=]*)/g,function(e,a,o){"undefined"!=typeof n[a]?n[a]+=","+decodeURIComponent(o):n[a]=decodeURIComponent(o)}),n}(),isRedirect=urlParams&&urlParams.code&&urlParams.state,isRR=urlParams&&urlParams.rr&&urlParams.rr.length;isWX?isRedirect||isRR||replaceUrlByTimeline():ajax2BackendByPhp("scanCodePay",{id:"0101",amount:"0.01",openId:"oDpaVjui28PrVkUHjaCdbjxJvUb0",authCode:"qr11233333",debugMode:"1"},function(e){alert(JSON.stringify(e))}),document.addEventListener("DOMContentLoaded",function(){function e(e){ajax2Php("wxJsSignature",null,function(e){var n="data = "+JSON.stringify(e);console.log(n);var a=e;$.extend(a,{debug:!1,jsApiList:["scanQRCode"]}),wx.config(a),wx.ready(function(){console.log(">> ready")}),wx.error(function(e){})})}if(console.log("Got DOMContentLoaded"),$("#money").val(amount),$("#refresh").on("click",function(){replaceUrlByTimeline()}),$("#submit").on("click",function(){console.log("click"),wx.ready(function(){console.log(">> ready"),wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){var n=e.resultStr;if(n&&n.length){var o={id:$("#channel").val()+"01",amount:$("#money").val(),openId:a,authCode:n};ajax2BackendByPhp("scanCodePay",o,function(e){},function(e){alert(JSON.stringify(e))})}}})})}),isWX){var n="www.qianduoduo.com.openid";if(isRedirect)ajax2Php("fetchOpenid",null,function(o){a=o.openid,localStorage.setItem(n,a),e(a)});else if(isRR){var a=localStorage.getItem(n);a&&a.length?e(a):window.location.href=PHP_ROOT+"?appName="+appName+"&requestAction=fetchCode"}}else e("12344567890")},!1);</script></body></html>